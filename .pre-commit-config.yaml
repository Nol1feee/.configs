default_stages: [pre-commit]

repos:
  # OpenAPI validation + regen
  - repo: local
    hooks:
      - id: openapi-regen
        name: OpenAPI regen
        entry: make api-regen
        language: system
        pass_filenames: false
        description: openapi regen

      - id: openapi-lint
        name: OpenAPI Lint (vacuum)
        entry: make api-lint
        language: system
        files: ^api/openapi/.*\.yml$
        pass_filenames: false
        description: Lint OpenAPI specifications with vacuum

      - id: openapi-breaking
        name: OpenAPI Breaking Changes (oasdiff)
        entry: make api-breaking
        language: system
        files: ^api/openapi/.*\.yml$
        pass_filenames: false
        description: Check for breaking changes in OpenAPI specs against origin/main

  # Go linting and formatting
  - repo: local
    hooks:
      - id: golangci-lint
        name: golangci-lint
        entry: make lint
        language: system
        files: \.go$
        pass_filenames: false
        description: Run golangci-lint

      - id: gci
        name: gci (Go imports formatter)
        entry: make gci-fix
        language: system
        files: \.go$
        pass_filenames: false
        description: Format Go imports with gci

  # Go tests
  - repo: local
    hooks:
      - id: go-test
        name: Go Tests
        entry: go test ./...
        language: system
        files: \.go$
        pass_filenames: false
        description: Run all Go tests
